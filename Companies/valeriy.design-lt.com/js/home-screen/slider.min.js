/*!
 * kontext
 * http://lab.hakim.se/kontext
 * MIT licensed
 *
 * Copyright (C) 2013 Hakim El Hattab, http://hakim.se
 */
window.kontext=function(a){var e=new kontext.Signal();var f=Array.prototype.slice.call(a.querySelectorAll(".layer"));var h="WebkitPerspective" in document.body.style||"MozPerspective" in document.body.style||"msPerspective" in document.body.style||"OPerspective" in document.body.style||"perspective" in document.body.style;if(h){a.classList.add("capable")}f.forEach(function(m,l){if(!m.querySelector(".dimmer")){var n=document.createElement("div");n.className="dimmer";m.appendChild(n)}});function j(m,l){f=Array.prototype.slice.call(a.querySelectorAll(".layer"));a.classList.add("animate");l=l||(m>b()?"right":"left");if(typeof m==="string"){m=parseInt(m)}if(typeof m!=="number"){m=b(m)}m=Math.max(Math.min(m,f.length),0);if(f[m]&&!f[m].classList.contains("show")){f.forEach(function(o,n){o.classList.remove("left","right");o.classList.add(l);if(o.classList.contains("show")){o.classList.remove("show");o.classList.add("hide")}else{o.classList.remove("hide")}});f[m].classList.add("show");e.dispatch(f[m],m)}}function d(){var l=b()-1;j(l>=0?l:f.length+l,"left")}function g(){j((b()+1)%f.length,"right")}prevSlide.onclick=function(){d()};nextSlide.onclick=function(){g()};function b(m){var l=0;f.forEach(function(o,n){if((m&&m==o)||(!m&&o.classList.contains("show"))){l=n;return}});return l}function c(){return f.length}return{show:j,prev:d,next:g,getIndex:b,getTotal:c,changed:e}};kontext.Signal=function(){this.listeners=[]};kontext.Signal.prototype.add=function(a){this.listeners.push(a)};kontext.Signal.prototype.remove=function(b){var a=this.listeners.indexOf(b);if(a>=0){this.listeners.splice(a,1)}};kontext.Signal.prototype.dispatch=function(){var a=Array.prototype.slice.call(arguments);this.listeners.forEach(function(c,b){c.apply(null,a)})};var k=kontext(document.querySelector(".kontext"));var bulletsContainer=document.body.querySelector(".bullets");for(var i=0,len=k.getTotal();i<len;i++){var bullet=document.createElement("li");bullet.className=i===0?"active":"";bullet.setAttribute("index",i);bullet.onclick=function(a){k.show(a.target.getAttribute("index"))};bullet.ontouchstart=function(a){k.show(a.target.getAttribute("index"))};bulletsContainer.appendChild(bullet)}k.changed.add(function(e,c){var b=document.body.querySelectorAll(".bullets li");for(var d=0,a=b.length;d<a;d++){b[d].className=d===c?"active":""}});document.addEventListener("keyup",function(a){if(a.keyCode===37){k.prev()}if(a.keyCode===39){k.next()}},false);var touchX=0;var touchConsumed=false;document.addEventListener("touchstart",function(a){touchConsumed=false;lastX=a.touches[0].clientX},false);document.addEventListener("touchmove",function(a){a.preventDefault();if(!touchConsumed){if(a.touches[0].clientX>lastX+10){k.prev();touchConsumed=true}else{if(a.touches[0].clientX<lastX-10){k.next();touchConsumed=true}}}},false);